6868	0	520513	5099825	NR	rawphd	3/14/11 6:06 PM	1.30012596E12	XP Pro SP3 Won't Install With APIC Enabled	Summary - Windows XP Pro SP3 will not install when APIC is enabled in bios. Hardware - Asus M4A785-M (flashed to latest BIOS version of 1006), 2 sticks of 1GB DDR2 800 from G.SKILL, GeForce 8400GS 512MB video card in the PCIe 2.0X16 slot, Athlon II X4 640 3.0 GHz 95W processor, hard drive connected via SATA, 480W power supply. Details - I originally had this system running with a Sempron processor without any problems. I then upgraded to the Athlon II Quad Core. Everything seemed to be okay for a while (although I never did check to see if all 4 cores were running). I got a BSOD one day and the system would not boot (even into safe mode) without a BSOD. I noticed that the hard drive reported some bad sectors, so I backed up what I could and re-formatted and did a clean install of XP Pro SP3. When the system did its first re-boot during install, I got a BSOD of No_More_IRP_Stack_Locations. I get this error no matter what I have tried, except for turning off APIC in the bios. When I turn off APIC, XP will install correctly, but of course it installs as a Standard PC and only one core is active. What I've Tried - I originally thought this was a hard drive problem, since bad sectors were being reported. However, I've checked the hard drive with the manufacturer's testing program and all was well. I also have tried using a completely different drive with no luck. That rules out a problem with the hard drive. I also suspected bad RAM. I've tried moving the two sticks around into different slots with no success. I also ran Memtest overnight without any errors. That seems to rule out bad RAM as a problem. I then turned my attention to the other hardware, and I've tried removing all peripherals and the video card before installing XP Pro. I had no success there, either. I suspect the hardware is fine, as I can run a LiveCD of Ubuntu without any problems, and with all four cores running. I tinkered around with various BIOS settings, which is how I discovered it was related to the ACIP setting. The first thing I did was flash to the latest BIOS version (1006), but no luck there. I've read that people have tried disabling legacy USB support and APM before install, but that did not work for me. I tried using the setup defaults, and also turning off ACPI and PnPOS, but nothing helped. The only setting that changed anything was to disable APIC. I even tried forcing XP Pro to choose a different HAL during install. I disabled ACPI and tried to force the MPS Multiprocessor HAL. That gave me a different BSOD (Bad_Pool_Header), but it did not fix my problem. Overall, I've tried installing XP Pro at least a dozen times trying different settings. This has been the most frustrating computer issue I've had, and I'm out of ideas. Right now I'm running XP Pro with only one core of my quad core active, which is a big hit on performance. I'm also starting to get some random lock-ups, but I don't know if they are related to the APIC issue or not. If anyone has any ideas on how to get XP Pro to communicate with this motherboard when APIC is activated, please let me know.
6868	1	520513	5099812	5099825	R. Proffitt	3/14/11 6:18 PM	1.30012668E12	It's time.	Unless this XP Pro is some odd ball hacked version I have to take the errors as the sign they are. Some hardware issue. The 8400 video card is a known bad thing. Try another card. And also try Linux. If linux fails we know... Bob
6868	2	520513	5100116	5099812	rawphd	3/15/11 8:10 AM	1.3001766E12	Done that	Thanks for the reply. As I mentioned in my post, I don't think it is a hardware issue. I have removed the video card from the system and used the on-board video with the same results. I also mentioned that I've tried Linux - I can run Ubuntu with no problems whatsoever. Any other ideas?
6868	3	520513	5100117	5099812	rawphd	3/15/11 8:12 AM	1.30017672E12	XP Pro	I should also mention that the XP Pro SP3 disk is the real deal. No hacked versions here.
6868	4	520513	5100121	5100116	R. Proffitt	3/15/11 8:23 AM	1.30017738E12	As long as you think it's not hardware.	You will be in an endless loop. XP installs without such drama on good machines. Sorry but this lesson is a hard one for some. That is, there are folk that feel that Windows XP has some flaw that causes the above issue. Yes there is that SATA hard drive support item but here, we are looking for something amiss with the machine. Now that you've declared it's not hardware, I have to unsubscribe and wait. bob
6868	5	520513	5100152	5100121	rawphd	3/15/11 9:35 AM	1.3001817E12	Thanks anyway	Bob, I'm not necessarily blaming XP. I just think that the processor, chipset, and XP aren't communicating when it comes to APIC. It could be a hardware issue that Ubuntu ignores and XP doesn't. Maybe I have a flaky chipset or processor. I don't usually have this much trouble tracking down problems, but this one has me stumped.
6868	6	520513	5100162	5100152	R. Proffitt	3/15/11 9:42 AM	1.30018212E12	Tracking it down.	Is not hard, just can cost us some coin. For years I've fixed these by swapping out the parts (CPU, board, etc) until we find the bad part. But that's the rough lesson for some new techs. Once in a while you encounter the new tech that thinks it's some bug in XP. If it was, then what would you do? You found a workaround for the hardware so there are choices to either replace the parts or just let it stay with APIC disabled. Bob
6868	7	520513	5100217	5099825	Willy	3/15/11 10:59 AM	1.30018674E12	WAG, but...	While you point out the APIC issue is the root of your problem. That in turn suggests the mtrbd, which supports this feature maybe less than it should be. Further, since it all worked before and now you have a new cpu of quad-core the chipset or mtrbd. is lacking in its output. You've basically have found a Achilles heel or glitch because at the time of the initial release the cpu wasn't supported or full support has fallen. That mtrbd, if replaced(with newer) would probably resolve the problem and/or reduce the cpu core(s) and or demand less from it. It boils down from your results, that the mtrbd. just isn't as capable. Of course, if it is some XP related issue, then going with Win7 install to see if that resolves it provided you want to go that route. I also don't recall XP supporting multiple cpu cores other than XP 64-bit version. Even then the 64-bit versions had issues as well. The 32-bit version would acknowledge multiple cores but used only 1, again if I recall right. That info was based on just dual-core, maybe quad-core is too much. Add it all up and a glitch is found, IMO. tada -----Willy
6868	8	520513	5100266	5100217	rawphd	3/15/11 12:18 PM	1.30019148E12	Thanks, Willy	I think XP Pro supports multiple cores, at least with SP3. Otherwise, why would there be multiprocessor HALs included? I tried to force both the APCI Multiprocessor and MPS Multiprocessor HALs, but no luck. You are probably right about the motherboard not fully supporting the X4 processor, or at least not supporting it enough for XP's comfort. So far I haven't been able to get anything out of Asus about it, though.
6868	9	520513	5100301	5100266	R. Proffitt	3/15/11 1:16 PM	1.30019496E12	The core count in XP is	Not an issue here. I think you are looking at a hardware issue or a bios one but the only new thought I have is the RAM speed seems low. Bob
6868	10	520513	5100362	5100301	rawphd	3/15/11 2:47 PM	1.30020042E12	RAM Speed?	Bob, what do you mean by RAM speed? The RAM is rated DDR2 800, and I have it set to the SPD settings in BIOS. Do you think it should be set at 1066, even though it isn't rated for it?
6868	11	520513	5100440	5100362	R. Proffitt	3/15/11 5:17 PM	1.30020942E12	Why do you have to set this in the BIOS?	There's another clue (sort of like the sound of a shoe dropping.) If you are manually setting memory timing it makes me think the BIOS is daft or the memory speed is not in sync with the new CPU. The links I skimmed over seem to note 1066 as the bottom end speed to fit with this CPU? Bob
6868	12	520513	5100919	5100440	rawphd	3/16/11 10:36 AM	1.30027176E12	I'm not setting it in BIOS	I'm not setting the memory timings manually. They are set at the automatic SPD detect. Are you saying that you think my memory is too slow for the CPU?
6868	13	520513	5100922	5100919	R. Proffitt	3/16/11 10:40 AM	1.300272E12	Sorry.	When I read &quot;and I have it set to the SPD settings in BIOS&quot; I thought you were entering in the timing. Yes, it sounds a notch too low according to what I read. Try this. Head to the BIOS and enter the slowest settings for the ram possible. I don't hold much hope for that but all the above points to some odd BIOS+CPU issue. XP does fine on quad core machines here and has for years. While I've lost count of how many I installed, the HP d4999t and d5000 we have at home ran XP without such loopiness. Now they run 7 64 bit. Bob
